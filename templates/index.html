<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" /> 
        <title>æ¬¢è¿ä½¿ç”¨Nino</title>
        <link rel="icon" href="{{ url_for('static', filename='mini_logo.png') }}">
        <script src="{{ url_for('static', filename='jquery-2.0.2.min.js') }}"></script>
        
        <script>
            (function() {
                var rawColor = "{{ theme_color }}";
                if (!rawColor) rawColor = "FF9800"; 
                var hex = "#" + rawColor.replace(/^#/, '');

                var r = parseInt(hex.substring(1, 3), 16);
                var g = parseInt(hex.substring(3, 5), 16);
                var b = parseInt(hex.substring(5, 7), 16);

                r /= 255, g /= 255, b /= 255;
                var max = Math.max(r, g, b), min = Math.min(r, g, b);
                var h, s, l = (max + min) / 2;

                if (max == min) {
                    h = s = 0; 
                } else {
                    var d = max - min;
                    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                    switch (max) {
                        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                        case g: h = (b - r) / d + 2; break;
                        case b: h = (r - g) / d + 4; break;
                    }
                    h /= 6;
                }
                
                function hslToHex(h, s, l) {
                    var r, g, b;
                    if (s == 0) {
                        r = g = b = l; 
                    } else {
                        var hue2rgb = function hue2rgb(p, q, t) {
                            if (t < 0) t += 1;
                            if (t > 1) t -= 1;
                            if (t < 1/6) return p + (q - p) * 6 * t;
                            if (t < 1/2) return q;
                            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                            return p;
                        }
                        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                        var p = 2 * l - q;
                        r = hue2rgb(p, q, h + 1/3);
                        g = hue2rgb(p, q, h);
                        b = hue2rgb(p, q, h - 1/3);
                    }
                    var toHex = function(x) {
                        var hex = Math.round(x * 255).toString(16);
                        return hex.length === 1 ? '0' + hex : hex;
                    };
                    return "#" + toHex(r) + toHex(g) + toHex(b);
                }

                // è°ƒé«˜äº†é¥±å’Œåº¦å‚æ•° (ç¬¬äºŒä¸ªå‚æ•°)
                var cssVars = {
                    '--c-bg': hslToHex(h, 0.6, 0.97),         // èƒŒæ™¯ï¼š0.4 -> 0.6
                    '--c-card': hslToHex(h, 0.75, 0.92),      // å¡ç‰‡ï¼š0.45 -> 0.75
                    '--c-hover': hslToHex(h, 0.5, 0.94),      // æ‚¬åœï¼š0.3 -> 0.5
                    '--c-accent': hslToHex(h, 0.95, 0.85),    // æŒ‰é’®/é«˜äº®ï¼š0.6 -> 0.95 (æ›´é²œè‰³)
                    '--c-text-sub': hslToHex(h, 0.5, 0.40),   // æ¬¡è¦æ–‡å­—ï¼š0.25 -> 0.5
                    '--c-text': hslToHex(h, 0.6, 0.29),       // ä¸»è¦æ–‡å­—ï¼š0.3 -> 0.6
                    '--c-placeholder': hslToHex(h, 0.3, 0.82),// å ä½ç¬¦ï¼š0.15 -> 0.3
                    '--c-focus': hslToHex(h, 1.0, 0.50),      // ç„¦ç‚¹ï¼šä¿æŒé«˜é¥±å’Œ
                    '--c-shadow': hslToHex(h, 0.3, 0.80)      // é˜´å½±è‰²ï¼š0.1 -> 0.3
                };

                var style = document.createElement('style');
                var cssString = ':root {';
                for (var key in cssVars) {
                    cssString += key + ': ' + cssVars[key] + ';';
                }
                cssString += '}';
                style.innerHTML = cssString;
                document.head.appendChild(style);
            })();
        </script>
    </head>
    <body>
        <div class="layout-container">
            <div class="left-image">
                <img src="{{ left_image }}" alt="ä¸»é¢˜å›¾ç‰‡" class="theme-image">
            </div>
            
            <div class="right-content">
                <div id="menu">
                    <h1>NinoğŸ¥</h1>
                    <span><a href="/data">æ•°æ®ä¸­å¿ƒ</a> | <a href="#" id="config">è®¾ç½®</a> | <a href="#" id="about">å…³äº</a> | <a href="#" id="check-update">æ£€æŸ¥æ›´æ–°</a></span>
                </div>
                <div id="talk">
                    {% for content, content_type in context_list | zip(context_type_list) %}
                        <span class="message {{ content_type }}">{{ content }}</span>
                    {% endfor %}
                    <span class="message user" id="submit_show_user"></span>
                    <span class="message shell" id="submit_show_shell">ç­‰å¾…å¯¹æ–¹å›å¤...</span>
                    <form action="/send" method="post" id="form" enctype="multipart/form-data">
                        <div id="user-input-from">
                            <input type="text" required maxlength="186" name="content" id="content" placeholder="å‘é€æ¶ˆæ¯...">
                            <input type="file" name="attachment_file" id="attachment_file" 
                            accept=".txt,.md,.rtf,.log,.asc,.text,.csv,.tsv,.tab,.psv,.ssv,
                                .html,.htm,.css,.js,.ts,.json,.xml,.php,.py,.java,
                                .c,.h,.cpp,.hpp,.cs,.rb,.go,.swift,.kotlin,.scala,
                                .perl,.pl,.sh,.bash,.bat,.cmd,.sql,.lua,.rs,.dart,
                                .vue,.jsx,.tsx,.sass,.scss,.less,.styl">
                            <input type="submit" value="å‘é€" id="submit" >
                        </div>
                        <input type="checkbox" {% if reasoner %} checked="on" {% endif %} name="reasoner" id="reasoner">
                        <label for="reasoner" id="reasoner-text">ä½¿ç”¨æ€è€ƒæ¨¡å‹</label>
                        <input type="checkbox" {% if memory %} checked="on" {% endif %} name="memory" id="memory">
                        <label for="memory" id="memory-text">å…è®¸å†™å…¥é•¿æœŸè®°å¿†</label>
                        <input type="checkbox" {% if double_output %} checked="on" {% endif %} name="double_output" id="double_output">
                        <label for="double_output" id="double_output-text">å…è®¸åˆ†å‰²å›å¤</label>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal-mask"></div>
        <div class="modal">
            <span class="modal-close">X</span>
            <div class="modal-content">
                <h2 class="modal-title">NinoğŸ¥</h2>
                <p class="modal-version">ver 2.2.0</p>
                <div class="modal-info">
                    <p>ä½œè€…ï¼šPinpe</p>
                    <p>æŠ€æœ¯æ ˆï¼šPythonã€Flaskã€jQuery</p>
                    <p>ä¾èµ–ï¼šflaskã€requestsã€openai</p>
                    <p>å¼€æºåè®®ï¼šGPL-3.0</p>
                    <p>ä»“åº“ï¼š<a href="https://github.com/Pinpe/nino-ai-chat" target="_blank" class="modal-link">https://github.com/Pinpe/nino-ai-chat</a></p>
                </div>
                <div class="modal-desc">
                    <p>Ninoæ˜¯AIèŠå¤©è½¯ä»¶ï¼Œä¼šå°è¯•äº†è§£ä½ ï¼Œç†è§£ä½ ï¼Œå¹¶ä¸”å¯ä»¥æ°¸è¿œè®°ä½é‡è¦è®°å¿†ï¼Œä¼šæ ¹æ®ç”¨æˆ·è¾“å…¥ã€ä¸Šä¸‹æ–‡ã€é•¿æœŸè®°å¿†åº“å’Œå¤–éƒ¨ç¯å¢ƒå¯¹ä½ è¿”å›å¯çˆ±çš„å›å¤ï¼Œå¯ç”¨äºèŠå¤©å’Œæ—¥å¸¸å¿ƒç†è°ƒé€‚ã€‚</p>
                    <p>Ninoæ˜¯å¼€æºçš„ï¼Œè·¨å¹³å°çš„ï¼Œè½»é‡çº§çš„ï¼ŒNinoçš„æ‰€æœ‰æ•°æ®å‡åœ¨æœ¬åœ°ï¼Œä»…åœ¨éœ€è¦æ—¶ä¼šæŠŠä¸€éƒ¨åˆ†æ•°æ®å‘é€ç»™ç¬¬ä¸‰æ–¹APIã€‚</p>
                    <p>æ³¨æ„ï¼šAIçš„å›å¤å¯èƒ½ä¼šå› ä¸ºå¹»è§‰å¯¼è‡´äº‹å®ã€è§‚ç‚¹ç­‰é”™è¯¯ï¼Œä¸ä¸€å®šæ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œè¯·æœ‰åŸºæœ¬çš„åˆ¤æ–­èƒ½åŠ›ï¼ŒNinoåŠå…¶ä½œè€…ä¸ä¸ºæ­¤ä»˜å‡ºä»»ä½•è´£ä»»ã€‚</p>
                </div>
            </div>
        </div>
        <div class="config-modal">
            <span class="config-modal-close">X</span>
            <div class="config-modal-content">
                <h1>è®¾ç½®</h1>
                <div class="modal-desc"><p>ä½ å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹Ninoçš„é…ç½®ï¼Œè¿™é‡Œçš„é€‰é¡¹å°†æ°¸ä¹…å­˜å‚¨ï¼Œæ­¤å¡ç‰‡ä¹Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å¼¹å‡ºã€‚</p></div>
                <form action="/config" method="post">
                        <input type="checkbox" {% if show_memory %} checked="on" {% endif %} name="show-memory" id="show-memory">
                        <label for="show-memory" id="show-memory-text" style="margin-bottom: 15px;">æ˜¾ç¤ºæ–°æ·»åŠ çš„é•¿æœŸè®°å¿†</label><br>
                        <label for="location" id="location-text">å±…ä½åŸå¸‚ï¼š</label>
                        <input type="text" value="{{ location }}" required maxlength="4" name="location" id="location" style="margin-bottom: 10px;"><br>
                        <label for="location" id="location-text">å¯†ç é”å¯†ç ï¼ˆä¸ºç©ºä¸è®¾ç½®ï¼‰ï¼š</label>
                        <input type="text" value="{{ login_password }}" maxlength="6" name="login-password" id="location" style="margin-bottom: 10px;"><br>
                        <label for="location" id="location-text">ä¸»é¢˜è‰²ï¼š</label>
                        <input type="text" value="{{ theme_color }}" required maxlength="6" name="theme-color" id="location" style="margin-bottom: 10px;"><br>
                        <label for="left-image" id="location-text">èƒŒæ™¯å›¾URLï¼š</label>
                        <input type="text" value="{{ left_image }}" required name="left-image" id="left-image-src" style="margin-bottom: 10px;">
                        <label for="left-image" id="location-text">æ¨¡å‹çš„base_urlï¼š</label>
                        <input type="text" value="{{ model_base_url }}" required name="model-base-url" id="left-image-src" style="margin-bottom: 10px;">
                        <label for="left-image" id="location-text">æ€è€ƒæ¨¡å‹åç§°ï¼š</label>
                        <input type="text" value="{{ reasoner_model }}" required name="reasoner-model" id="location" style="margin-bottom: 10px; width: 180px;"><br>
                        <label for="left-image" id="location-text">éæ€è€ƒæ¨¡å‹åç§°ï¼š</label>
                        <input type="text" value="{{ common_model }}" required name="common-model" id="location" style="margin-bottom: 15px; width: 180px;">
                        <br>
                        <input type="submit" value="ä¿å­˜å¹¶å…³é—­" id="submit" >
                </form>
            </div>
        </div>

        <div class="update-modal">
            <span class="update-modal-close">X</span>
            <h1>æ£€æŸ¥æ›´æ–°</h1>
            <div class="modal-desc"><p>é€šè¿‡Ninoçš„åœ¨çº¿æœåŠ¡å™¨ï¼Œæ£€æŸ¥æœ€æ–°ç‰ˆæœ¬çŠ¶æ€ã€‚</p></div>
            <div class="update-modal-content">
                
                <div class="update-info">
                    <div class="update-row">
                        <span class="update-label">å½“å‰ç‰ˆæœ¬</span>
                        <span class="update-value">2.2.0</span>
                    </div>
                    <div class="update-row">
                        <span class="update-label">æœ€æ–°ç‰ˆæœ¬</span>
                        <span class="update-value" id="latest-version">{{ latest_version }}</span>
                    </div>
                </div>
                <a href="https://github.com/Pinpe/nino-ai-chat/releases/tag/{{ latest_version }}" target="_blank" class="update-button" id="update-button">æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬</a>
            </div>
        </div>

        <script>
            $(function(){
                first_use = ({{ first_use }});
                
                // åˆå§‹çŠ¶æ€éšè—ï¼ˆæ·»åŠ update-modalï¼‰
                $('#submit_show_user').hide();
                $('#submit_show_shell').hide();
                $('.modal-mask, .modal, .config-modal, .update-modal').hide();

                if (first_use == true) {
                    // å¦‚æœæ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œä¼˜é›…åœ°æ˜¾ç¤ºè®¾ç½®å¼¹çª—
                    $('.modal-mask').fadeIn(5);
                    $('.config-modal').show(); // CSSåŠ¨ç”»å¤„ç†å¼¹å‡ºæ•ˆæœ
                }
            })

            $('#form').submit(function(){
                $('#submit').attr('disabled', 'true')
                $('#submit_show_user').text($('#content').val()).show()
                $('#submit_show_shell').show()
            })

            // å…³äºæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            $('#about').click(function(e){
                e.preventDefault();
                $('.modal-mask').fadeIn(5);
                $('.modal').show();
            })

            // è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            $('#config').click(function(e){
                e.preventDefault();
                $('.modal-mask').fadeIn(5);
                $('.config-modal').show();
            })

            // æ–°å¢ï¼šæ£€æŸ¥æ›´æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            $('#check-update').click(function(e){
                e.preventDefault();
                $('.modal-mask').fadeIn(5);
                $('.update-modal').show();
                
                // åŠ¨æ€å¤„ç†æŒ‰é’®çŠ¶æ€ï¼šæ— æ³•è·å–ç‰ˆæœ¬æ—¶ç¦ç”¨æŒ‰é’®
                const latestVersion = $('#latest-version').text().trim();
                const updateButton = $('#update-button');
                if (latestVersion === 'None') {
                    updateButton.hide()
                    $('#latest-version').text('å½“å‰æ— æ³•è·å–æœ€æ–°ç‰ˆæœ¬ï¼Œç¨åå†è¯•è¯•')
                } else {
                    updateButton.attr('disabled', false);
                    updateButton.attr('href', `https://github.com/Pinpe/nino-ai-chat/releases/tag/${latestVersion}`);
                }
            })

            // å…³é—­å¼¹çª—äº‹ä»¶ï¼ˆæ·»åŠ update-modal-closeï¼‰
            $('.modal-close, .config-modal-close, .update-modal-close').click(function(){
                $('.modal-mask').fadeOut(0);
                $('.config-modal, .modal, .update-modal').fadeOut(0);
            })
        </script>

        <style>
            @font-face {
                font-family: font;
                src: url({{ url_for('static', filename='font.ttf') }});
            }
            * {
                font-family: font;
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background-color: var(--c-bg);
                color: var(--c-text);
                min-height: 100vh;
                padding: 0;
                margin: 0 auto;
                line-height: 1.6;
            }

            #menu a{
                color: var(--c-text);
                text-decoration: none;
                transition: all 0.15s ease;
            }

            #menu a:hover{
                background-color: var(--c-hover);
            }

            .layout-container {
                width: 100%;
                min-height: 100vh;
            }

            /* å·¦ä¾§å›¾ç‰‡ç»å¯¹å›ºå®š */
            .left-image {
                position: fixed;
                top: 0;
                left: 0;
                width: 33.333%;
                height: 100vh;
                overflow: hidden;
                z-index: 999;
            }

            .theme-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                object-position: center;
                display: block;
            }

            /* å³ä¾§å†…å®¹åŒºé¿å¼€å·¦ä¾§å›ºå®šåŒºåŸŸ */
            .right-content {
                width: 66.666%;
                min-height: 100vh;
                padding: 20px 15px;
                max-width: 800px;
                margin-left: 40%;
                overflow-y: auto;
            }

            title {
                display: none;
            }

            #talk {
                padding: 25px 20px;
                margin-bottom: 30px;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .message {
                display: inline-block;
                padding: 10px 18px;
                border-radius: 22px;
                max-width: 75%;
                word-wrap: break-word;
            }

            .message.user {
                background-color: var(--c-accent);
                margin-left: auto;
            }

            .message.ai {
                background-color: var(--c-card);
                margin-right: auto;
            }

            .message.shell{
                color: var(--c-text-sub);
                opacity: 0.8; 
                margin-left: auto;
                margin-right: auto;
            }

            #menu{
                padding: 25px 40px;
            }

            form{
                align-items: center;
                padding: 15px 20px;
            }

            #user-input-from {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
                margin-bottom: 12px;
            }

            #reasoner, #memory, #show-memory, #double_output {
                accent-color: var(--c-accent);
                display: inline-block;
            }
            #memory, #double_output{
                margin-left: 20px;
            }

            label {
                color: var(--c-text-sub);
                font-size: 14px;
                cursor: pointer;
                display: inline-block;
            }

            #content {
                flex: 1;
                min-width: 200px;
                padding: 12px 15px;
                border: 2px solid var(--c-accent);
                border-radius: 25px;
                font-size: 15px;
                transition: all 0.3s ease;
                background-color: var(--c-bg); 
                color: var(--c-text);
            }

            #content::placeholder {
                color: var(--c-placeholder);
            }

            #content:focus {
                outline: none;
                border-color: var(--c-focus);
            }

            #location, #left-image-src, #login_password {
                padding: 5px 15px;
                width: 100px;
                border: 2px solid var(--c-accent);
                border-radius: 25px;
                font-size: 15px;
                transition: all 0.3s ease;
                background-color: var(--c-bg);
                color: var(--c-text);
            }

            #left-image-src{
                width: 400px;
            }

            #location:focus {
                outline: none;
                border-color: var(--c-focus);
            }

            #left-image-src:focus{
                outline: none;
                border-color: var(--c-focus);
            }

            #submit, input::file-selector-button {
                background-color: var(--c-accent);
                border: none;
                padding: 12px 25px;
                border-radius: 25px;
                font-size: 15px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.1s ease;
                color: var(--c-text);
            }

            #submit:hover {
                transform: translateY(-2px);
            }

            #submit:active {
                transform: translateY(0);
            }

            #attachment_file{
                width: 114px;
            }

            /* å¼¹çª—åŸºç¡€æ ·å¼ */
            @keyframes modal-in {
                0% {
                    opacity: 0;
                    transform: translate(-50%, -40%) scale(0.95);
                }
                100% {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
            }

            .modal-mask {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background-color: rgba(0, 0, 0, 0.3); 
                z-index: 1000;
                backdrop-filter: blur(5px);
                transition: opacity 0.3s ease;
            }

            .modal, .config-modal, .update-modal {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: var(--c-bg);
                border-radius: 20px;
                padding: 30px;
                width: 100%;
                z-index: 1001;
                box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
                animation: modal-in 0.2s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
            }

            .modal {
                max-width: 850px;
            }

            .config-modal{
                max-width: 550px;
            }

            /* æ–°å¢ï¼šæ£€æŸ¥æ›´æ–°å¼¹çª—æ ·å¼ */
            .update-modal {
                max-width: 500px;
            }

            .update-info {
                margin: 30px 0;
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            .update-row {
                display: flex;
                justify-content: space-between;
                padding: 12px 25px;
                background-color: var(--c-card);
                border-radius: 15px;
            }

            .update-label {
                color: var(--c-text-sub);
                font-size: 16px;
                font-weight: 500;
            }

            .update-value {
                color: var(--c-text);
                font-size: 16px;
                font-weight: 600;
            }

            .update-button {
                display: inline-block;
                background-color: var(--c-accent);
                border: none;
                padding: 12px 35px;
                border-radius: 25px;
                font-size: 15px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.15s ease;
                color: var(--c-text);
                text-decoration: none;
                margin-top: 10px;
            }

            .update-button:hover {
                transform: translateY(-2px);
            }

            .update-button:active {
                transform: translateY(0);
            }

            .update-button:disabled {
                background-color: var(--c-placeholder);
                color: var(--c-text-sub);
                cursor: not-allowed;
                transform: none;
            }

            /* å¼¹çª—å…³é—­æŒ‰é’®é€šç”¨æ ·å¼ */
            .modal-close, .config-modal-close, .update-modal-close {
                position: absolute;
                top: 15px;
                right: 20px;
                font-size: 18px;
                color: var(--c-text);
                cursor: pointer;
                transition: all 0.2s ease;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background-color: var(--c-card);
                display: flex;
                align-items: center;
                justify-content: center;
                line-height: 1;
            }

            .modal-close:hover, .config-modal-close:hover, .update-modal-close:hover {
                background-color: var(--c-accent);
            }

            .modal-content, .update-modal-content {
                text-align: center;
                margin-top: 10px;
            }

            .modal-title {
                font-size: 55px;
                color: var(--c-text);
                margin-bottom: 8px;
            }

            .modal-version {
                font-size: 14px;
                color: var(--c-text-sub);
                margin-bottom: 20px;
                margin-top: -10px;
            }

            .modal-info {
                margin-bottom: 20px;
                line-height: 1.8;
                text-align: left;
            }

            .modal-link {
                color: var(--c-text);
                text-decoration: none;
                transition: text-decoration 0.2s ease;
            }

            .modal-link:hover {
                text-decoration: underline;
            }

            .modal-desc {
                color: var(--c-text);
                line-height: 1.8;
                text-align: left;
            }

            /* å“åº”å¼è°ƒæ•´ */
            @media (max-width: 768px) {
                .left-image {
                    position: relative;
                    width: 100%;
                    height: 30vh;
                }
                .right-content {
                    width: 100%;
                    min-height: 70vh;
                    margin-left: 0;
                    padding: 20px 15px;
                }
                #menu {
                    padding: 25px 20px;
                }
                .modal, .config-modal, .update-modal {
                    padding: 25px 20px;
                    max-width: 95%;
                }
                .modal-title {
                    font-size: 28px;
                }
                .update-row {
                    padding: 10px 15px;
                }
                .update-button {
                    padding: 10px 25px;
                }
            }
        </style>
    </body>
</html>